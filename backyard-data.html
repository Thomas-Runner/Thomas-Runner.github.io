<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RunnerLab â€” Backyard Data</title>
  <link rel="stylesheet" href="style.css" />

  <!-- PapaParse CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    body {
      background-color: #0b0b1a;
      color: #f0f0f5;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      margin: 0;
    }
    header.nav {
      position: fixed;
      top: 0;
      width: 100%;
      background: #0b0b1a;
      z-index: 1000;
      padding: 10px 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }
    h1 {
      color: #b388ff;
      text-align: center;
      margin: 120px 0 20px; /* Add top margin to avoid overlap with fixed header */
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #161628;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(179, 136, 255, 0.3);
    }
    th, td {
      padding: 10px 14px;
      text-align: left;
    }
    th {
      background: #1f1f3a;
      color: #c9a0ff;
      cursor: pointer;
      position: sticky;
      top: 0;
      z-index: 2;
    }
    tr:nth-child(even) {
      background: #141425;
    }
    tr:hover {
      background: #222245;
    }
    .glow-blue {
      color: #66aaff;
      text-shadow: 0 0 6px #66aaff;
    }
    .gbr-row {
      background: linear-gradient(90deg, #ff0000 0%, #ffffff 50%, #0000ff 100%) !important;
      color: #000;
      font-weight: bold;
    }
    select {
      background: #1f1f3a;
      color: #fff;
      border: 1px solid #b388ff;
      border-radius: 6px;
      padding: 5px 10px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
<header class="nav">
  <div class="nav-inner">
    <div class="brand">Runner<span>Lab</span></div>
    <nav class="links">
      <a href="index.html" class="nav-link">Home</a>
      <a href="calendar.html" class="nav-link">Calendar</a>
      <a href="all-runs.html" class="nav-link">All Runs</a>
      <a href="race-results.html" class="nav-link">Race Results</a>
      <a href="backyard-data.html" class="nav-link">Backyard Data</a>
    </nav>
  </div>
</header>

<h1>Backyard Ultra World Ranking</h1>

<label for="natFilter">Filter by Nation:</label>
<select id="natFilter">
  <option value="all">All</option>
</select>

<table id="backyardTable">
  <thead>
    <tr>
      <th data-col="Rank">Rank</th>
      <th data-col="Name">Name</th>
      <th data-col="Nat">Nat</th>
      <th data-col="Race">Race</th>
      <th data-col="Date">Date</th>
      <th data-col="Yards">Yards</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const tableBody = document.querySelector("#backyardTable tbody");
const natFilter = document.getElementById("natFilter");
let data = [];

// Load CSV
fetch("BACKYARD - World Ranking (1).csv")
  .then(response => response.text())
  .then(csvText => {
    const results = Papa.parse(csvText, { header: true, skipEmptyLines: true });
    data = results.data.filter(row => row.Rank);
    populateTable(data);
    populateNatFilter(data);
  })
  .catch(err => console.error("CSV load error:", err));


function populateTable(rows) {
  tableBody.innerHTML = "";
  rows.forEach(row => {
    const tr = document.createElement("tr");
    if (row.Nat === "GBR") tr.classList.add("gbr-row");
    ["Rank","Name","Nat","Race","Date","Yards"].forEach(col => {
      const td = document.createElement("td");
      td.textContent = row[col] || "";
      if (col === "Yards" && row[col] && row[col].includes("*")) td.classList.add("glow-blue");
      tr.appendChild(td);
    });
    tableBody.appendChild(tr);
  });
}

function populateNatFilter(rows) {
  const nations = [...new Set(rows.map(r => r.Nat))].sort();
  nations.forEach(nat => {
    const opt = document.createElement("option");
    opt.value = nat;
    opt.textContent = nat;
    natFilter.appendChild(opt);
  });
}

natFilter.addEventListener("change", () => {
  if (natFilter.value === "all") populateTable(data);
  else populateTable(data.filter(r => r.Nat === natFilter.value));
});

document.querySelectorAll("th").forEach(th => {
  th.addEventListener("click", () => {
    const col = th.dataset.col;
    let sorted = [...data];
    sorted.sort((a, b) => {
      if (col === "Yards") {
        const numA = parseInt((a.Yards || "").replace(/\D/g, "")) || 0;
        const numB = parseInt((b.Yards || "").replace(/\D/g, "")) || 0;
        return numB - numA;
      } else if (!isNaN(a[col]) && !isNaN(b[col])) {
        return a[col] - b[col];
      } else {
        return (a[col] || "").localeCompare(b[col] || "");
      }
    });
    populateTable(sorted);
  });
});
</script>
</body>
</html>
